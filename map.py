import pygame
import os
import random


# --- Map Settings ---
TILE_SIZE = 48
WIDTH = 13
HEIGHT = 13


# --- Design your map manually ---
MAPS = [
    [   # Map 1
        ["A","-","-","-","-","-","-","-","-","-","-","-","B"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["C","-","-","-","-","-","-","-","-","-","-","-","D"],
    ],
    [   # Map 2
        ["A","-","-","-","-","-","-","-","-","-","-","-","B"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".","#","#",".",".",".","#","#",".",".","|"],
        ["|",".",".","#","#",".",".",".","#","#",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".","#","#",".",".",".","#","#",".",".","|"],
        ["|",".",".","#","#",".",".",".","#","#",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["C","-","-","-","-","-","-","-","-","-","-","-","D"],
    ],
    [   # Map 3
        ["A","-","-","-","-","-","-","-","-","-","-","-","B"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".","X","X",".",".",".",".",".","X","X",".","|"],
        ["|",".","X",".",".",".",".",".",".",".","X",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".","#","#","#",".",".",".",".","|"],
        ["|",".",".",".",".","#","#","#",".",".",".",".","|"],
        ["|",".",".",".",".","#","#","#",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".","X",".",".",".",".",".",".",".","X",".","|"],
        ["|",".","X","X",".",".",".",".",".","X","X",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["C","-","-","-","-","-","-","-","-","-","-","-","D"],
    ],
    [   # Map 4
        ["A","-","-","-","-","-","-","-","-","-","-","-","B"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".","X","X",".",".",".","X","X",".",".","|"],
        ["|",".",".","X","X",".",".",".","X","X",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".","X","X",".",".",".","X","X",".",".","|"],
        ["|",".",".","X","X",".",".",".","X","X",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["C","-","-","-","-","-","-","-","-","-","-","-","D"],
    ],
    [   # Map 5
        ["A","-","-","-","-","-","-","-","-","-","-","-","B"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".","#","#",".",".",".","#","#",".",".","|"],
        ["|",".",".","#","#",".",".",".","#","#",".",".","|"],
        ["|",".",".","#","#",".",".",".","#","#",".",".","|"],
        ["|",".",".","#","#",".",".",".","#","#",".",".","|"],
        ["|",".",".","#","#",".",".",".","#","#",".",".","|"],
        ["|",".",".","#","#",".",".",".","#","#",".",".","|"],
        ["|",".",".","#","#",".",".",".","#","#",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["C","-","-","-","-","-","-","-","-","-","-","-","D"],
    ],
    [   # Map 6
        ["A","-","-","-","-","-","-","-","-","-","-","-","B"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".","X","X",".",".",".","X","X",".",".","|"],
        ["|",".",".","X","X",".",".",".","X","X",".",".","|"],
        ["|",".",".","X","X",".",".",".","X","X",".",".","|"],
        ["|",".",".","X","X",".",".",".","X","X",".",".","|"],
        ["|",".",".","X","X",".",".",".","X","X",".",".","|"],
        ["|",".",".","X","X",".",".",".","X","X",".",".","|"],
        ["|",".",".","X","X",".",".",".","X","X",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["C","-","-","-","-","-","-","-","-","-","-","-","D"],

    ],
    [   # Map 7
        ["A","-","-","-","-","-","-","-","-","-","-","-","B"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".","X","X",".",".",".","#","#",".",".","|"],
        ["|",".",".","X","X",".",".",".","#","#",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".","#","#",".",".",".","X","X",".",".","|"],
        ["|",".",".","#","#",".",".",".","X","X",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["C","-","-","-","-","-","-","-","-","-","-","-","D"],
    ],
    [   # Map 8
        ["A","-","-","-","-","-","-","-","-","-","-","-","B"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".","#","#",".",".",".","#","#",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".","#","#",".",".",".","#","#",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".","#","#",".",".",".","#","#",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["|",".",".",".",".",".",".",".",".",".",".",".","|"],
        ["C","-","-","-","-","-","-","-","-","-","-","-","D"],
    ]
]


game_map = random.choice(MAPS)

# --- Pygame setup ---
pygame.init()
screen = pygame.display.set_mode((0, 0), pygame.FULLSCREEN)
clock = pygame.time.Clock()

screen_width, screen_height = screen.get_size()
offset_x = (screen_width - WIDTH * TILE_SIZE) // 2
offset_y = (screen_height - HEIGHT * TILE_SIZE) // 2

# --- Load sprites ---
def load_sprite(filename, rotation=0):
    path = os.path.join("sprites", filename)
    img = pygame.image.load(path).convert_alpha()
    img = pygame.transform.scale(img, (TILE_SIZE, TILE_SIZE))
    if rotation != 0:
        img = pygame.transform.rotate(img, rotation)
    return img


SPRITES = {
    "-": load_sprite("wall_edge.png"),
    "|": load_sprite("wall_edge.png", 90),
    "X": load_sprite("lava.png"),
    "A": load_sprite("wall_corner.png", 90),
    "B": load_sprite("wall_corner.png"),
    "C": load_sprite("wall_corner.png", 180),
    "D": load_sprite("wall_corner.png", -90),
    "#": load_sprite("wall_middle.png")

}

# Floor sprites
FLOOR_SPRITES = [
    load_sprite("floor_1.png"),
    load_sprite("floor_2.png"),
    load_sprite("floor_3.png")
]

# --- Pre-generate floor choices to keep them consistent ---
floor_choices = [[None for _ in range(WIDTH)] for _ in range(HEIGHT)]
for y in range(HEIGHT):
    for x in range(WIDTH):
        if game_map[y][x] == ".":
            floor_choices[y][x] = random.choice(FLOOR_SPRITES)

# --- Main loop ---
running = True
while running:
    for event in pygame.event.get():
        if event.type == pygame.QUIT:
            running = False
        elif event.type == pygame.KEYDOWN:
            if event.key == pygame.K_ESCAPE:
                running = False

    # Draw map
    screen.fill((0,0,0))
    for y in range(HEIGHT):
        for x in range(WIDTH):
            tile = game_map[y][x]
            if tile == ".":
                sprite = floor_choices[y][x]
            else:
                sprite = SPRITES[tile]
            screen.blit(sprite, (offset_x + x*TILE_SIZE, offset_y + y*TILE_SIZE))

    pygame.display.flip()
    clock.tick(60)

pygame.quit()
